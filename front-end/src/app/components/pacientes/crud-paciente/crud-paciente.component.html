<div *ngIf="encuesta_id;else other_content">
	<app-header nombre="PROGRAMACIÓN DE ENCUESTAS" icono="edit"></app-header>
</div>

<ng-template #other_content>
	<app-header nombre="MANTENIMIENTO DE PACIENTES" icono="users"></app-header>
</ng-template>

<div class="widget clearfix mt-5">
	<div class="whead clearfix">
		<p><span *ngIf="id;else templateName">EDITAR </span>PACIENTE <span *ngIf="id">: {{ form.nombres }}
				{{ form.apellido_paterno }} {{ form.apellido_materno }}</span></p>
		<ng-template #templateName>
			CREAR
		</ng-template>
	</div>
	<div class="row data-crud">
		<div class="col-12">
			<form (ngSubmit)="guardar()" class="px-4" [formGroup]="formPaciente" novalidate="">
				<div class="row">
					<div class="col-6">
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Tipo Documento <span class="text-danger">*</span></label>
							<div class="col-sm-8">
								<select name="tipodoc" id="" class="form-control" formControlName="tipodoc" #tipodoc [(ngModel)]="form.tipo_documento" required>
									<option value="1" [selected]="true">DNI</option>
									<option value="2">RUC</option>
								</select>
							</div>
							<hr>
						</div>
						 
						<div class="form-group row my-3" *ngIf="tipodoc.value === '1'">
							<label class="col-sm-4 col-form-label w-100">Nro Documento <span
									class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="nrodoc" class="form-control" formControlName="nrodni" [ngClass]="{'is-invalid': !formPaciente.get('nrodni').valid}" [(ngModel)]="form.nro_documento"
									required/>
								<div *ngIf="formPaciente.controls['nrodni'].errors?.required" class="invalid-feedback">
									El dni es necesario
								</div>
								<div *ngIf="formPaciente.controls['nrodni'].errors?.minlength" class="invalid-feedback">
									Por lo menos 8 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nrodni'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 8 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nrodni'].errors?.pattern" class="invalid-feedback">
									Escribir solo números
								</div>
							</div>
							<hr>
						</div>

						<div class="form-group row my-3" *ngIf="tipodoc.value !== '1'">
							<label class="col-sm-4 col-form-label w-100">Nro Documento <span
									class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="nrodoc" class="form-control" formControlName="nroruc" [ngClass]="{'is-invalid': !formPaciente.get('nroruc').valid}" [(ngModel)]="form.nro_documento"
									required/>
								<div *ngIf="formPaciente.controls['nroruc'].errors?.required" class="invalid-feedback">
									El ruc es necesario
								</div>
								<div *ngIf="formPaciente.controls['nroruc'].errors?.minlength" class="invalid-feedback">
									Por lo menos 11 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nroruc'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 11 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nroruc'].errors?.pattern" class="invalid-feedback">
									Escribir solo números
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Nombres <span class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="nombres" class="form-control" formControlName="nombres" [ngClass]="{'is-invalid': !formPaciente.get('nombres').valid}" [(ngModel)]="form.nombres" required>
								<div *ngIf="formPaciente.controls['nombres'].errors?.required" class="invalid-feedback">
									El nombre es necesario
								</div>
								<div *ngIf="formPaciente.controls['nombres'].errors?.minlength" class="invalid-feedback">
									Por lo menos 3 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nombres'].errors?.pattern" class="invalid-feedback">
									Escribir solo letras
								</div>
							</div>
							<hr>
						</div>

						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Apellido Paterno <span
									class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="apepaterno" class="form-control" formControlName="apepaterno" [ngClass]="{'is-invalid': !formPaciente.get('apepaterno').valid}" [(ngModel)]="form.apellido_paterno"
									required/>
								<div *ngIf="formPaciente.controls['apepaterno'].errors?.required" class="invalid-feedback">
									El apellido es necesario
								</div>
								<div *ngIf="formPaciente.controls['apepaterno'].errors?.minlength" class="invalid-feedback">
									Por lo menos 3 caracteres
								</div>
								<div *ngIf="formPaciente.controls['apepaterno'].errors?.pattern" class="invalid-feedback">
									Escribir solo letras
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Apellido Materno <span
								class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="apematerno" class="form-control" formControlName="apematerno" [ngClass]="{'is-invalid': !formPaciente.get('apematerno').valid}" [(ngModel)]="form.apellido_materno" required>
								<div *ngIf="formPaciente.controls['apematerno'].errors?.required" class="invalid-feedback">
									El apellido es necesario
								</div>
								<div *ngIf="formPaciente.controls['apematerno'].errors?.minlength" class="invalid-feedback">
									Por lo menos 3 caracteres
								</div>
								<div *ngIf="formPaciente.controls['apematerno'].errors?.pattern" class="invalid-feedback">
									Escribir solo letras
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Fecha de Nacimiento <span
								class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="date" name="fechanac" class="form-control" [(ngModel)]="form.fecha_nacimiento" (change)="obtenerEdad()" [ngModelOptions]="{standalone: true}" required>
							</div>
							<hr>
						</div>

						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Edad <span
								class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="edad" class="form-control" [(ngModel)]="form.edad" [ngModelOptions]="{standalone: true}" readonly required>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Sexo <span class="text-danger">*</span></label>
							<div class="col-sm-8">
								<select name="sexo" id="" class="selectform form-control" [(ngModel)]="form.sexo" required>
									<option class="selectform" [ngValue]="null" [disabled]="true" [selected]="true">Elige una opción</option>
									<option class="selectform" value="1">FEMENINO</option>
									<option class="selectform" value="2">MASCULINO</option>
								</select>
							</div>
							<hr>
						</div>

						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Nro de Celular <span class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="text" name="nrocel" class="form-control" formControlName="nrocel" [ngClass]="{'is-invalid': !formPaciente.get('nrocel').valid}" [(ngModel)]="form.nro_celular" required>
								<div *ngIf="formPaciente.controls['nrocel'].errors?.required" class="invalid-feedback">
									El número de celular es necesario
								</div>
								<div *ngIf="formPaciente.controls['nrocel'].errors?.minlength" class="invalid-feedback">
									Por lo menos 9 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nrocel'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 9 caracteres
								</div>
								<div *ngIf="formPaciente.controls['nrocel'].errors?.pattern" class="invalid-feedback">
									Escribir solo números
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3" *ngIf="encuesta_id==null">
							<label class="col-sm-4 col-form-label w-100">Correo Personal <span class="text-danger">*</span></label>
							<div class="col-sm-8">
								<input type="email" name="email" class="form-control" formControlName="email" [ngClass]="{'is-invalid': !formPaciente.get('email').valid}" [(ngModel)]="form.email" required>
								<div *ngIf="formPaciente.controls['email'].errors?.required" class="invalid-feedback">
									El correo es necesario
								</div>
								<div *ngIf="formPaciente.controls['email'].errors?.pattern" class="invalid-feedback">
									Formato de correo no válido
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3" *ngIf="encuesta_id==null">
							<label class="col-sm-4 col-form-label w-100">Grupo Sanguíneo</label>
							<div class="col-sm-8">
								<input type="text" name="gruposan" class="form-control" formControlName="gruposan" [ngClass]="{'is-invalid': !formPaciente.get('gruposan').valid}" [(ngModel)]="form.grupo_sanguineo">
								<div *ngIf="formPaciente.controls['gruposan'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 4 caracteres
								</div>
								<div *ngIf="formPaciente.controls['gruposan'].errors?.pattern" class="invalid-feedback">
									Escribir solo letras y signos
								</div>
							</div>
							<hr>
						</div>
					</div>

					<div class="col-6">		
						<div class="form-group row my-3" *ngIf="encuesta_id==null">
							<label class="col-sm-4 col-form-label w-100">Dirección</label>
							<div class="col-sm-8">
								<input type="text" name="direccion" class="form-control" formControlName="direccion" [ngClass]="{'is-invalid': !formPaciente.get('direccion').valid}" [(ngModel)]="form.direccion">
								<div *ngIf="formPaciente.controls['direccion'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 250 caracteres
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3" *ngIf="encuesta_id==null">
							<label class="col-sm-4 col-form-label w-100">Referencias</label>
							<div class="col-sm-8">
								<input type="text" name="refer" class="form-control" formControlName="refer" [ngClass]="{'is-invalid': !formPaciente.get('refer').valid}" [(ngModel)]="form.referencias">
								<div *ngIf="formPaciente.controls['refer'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 250 caracteres
								</div>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Tipo de Paciente <span class="text-danger">*</span></label>
							<div class="col-sm-8">
								<select name="tipopac" id="" class="form-control" [(ngModel)]="form.tipo_paciente" required>
									<option value="1" [selected]="true">NUEVO</option>
									<option value="2">ANTIGUO</option>
								</select>
							</div>
							<hr>
						</div>
		
						<div class="form-group row my-3" *ngIf="encuesta_id==null">
							<label class="col-sm-4 col-form-label w-100">Observaciones</label>
							<div class="col-sm-8">
								<textarea type="text" name="obs" class="form-control" formControlName="obs" [ngClass]="{'is-invalid': !formPaciente.get('obs').valid}" [(ngModel)]="form.observaciones"></textarea>
								<div *ngIf="formPaciente.controls['obs'].errors?.maxlength" class="invalid-feedback">
									Por lo máximo 250 caracteres
								</div>
							</div>
							<hr>
						</div>
						
						<div class="form-group row my-3">
							<label class="col-sm-4 col-form-label w-100">Ubigeo <span
								class="text-danger">*</span></label>
							<div class="col-sm-8">
								<mat-form-field class="example-full-width w-100">
									<input type="text" [(ngModel)]="form.ubigeo_id" matInput name="ubigeo_id" class="form-control"
										   [formControl]="myControl" [matAutocomplete]="auto" required (keyup)="limpiarAutocomplete($event)">
									<mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="cargarUbigeo($event)">
										<mat-option *ngFor="let option of filteredUbigeo | async" [value]="option">
											{{option.departamento}} - {{option.provincia}} - {{option.distrito}}
										</mat-option>
									</mat-autocomplete>
								</mat-form-field>
							</div>
							<hr>
						</div>
					</div>
				</div>

				<div class="form-group row">
					<div class="col-12">
						<button type="submit" class="btn btn-success">GUARDAR</button>
						<a (click)="return()" class="btn btn-info text-white">REGRESAR A LA LISTA</a>
					</div>
				</div>
			</form>
		</div>

		<div class="col-5 p-0 widget clearfix" *ngIf="id">
			<app-auditoria [form]="form"></app-auditoria>
		</div>
	</div>
</div>
